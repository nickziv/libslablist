#!/bin/ksh

# The input size (we make it very large --- slab lists can handle it ;).

source ./cmd_arr


dtest[0]="../tests/insert.d"
dtest[1]="../tests/find_bubble_up.d"

# All tests execute asynchronously. Each job should, at peak, take up ~200M of
# RAM. Which means the tests need ~5G of RAM minimum to run. We can tolerate
# swapping, because we are not measuring performance. We are just checking
# correctness.
pfexec rm -r test_results 2> /dev/null
pfexec mkdir test_results
pfexec chmod go+rw test_results
rifile=test_results/insert_
rffile=test_results/find_
for i in {0..11}; do;

	pfexec dtrace -L /opt/libslablist/include/dtrace/ -c "${cmd[$i]}"\
		-s ${dtest[0]} -o $rifile$i &;

	pfexec dtrace -L /opt/libslablist/include/dtrace/ -c "${cmd[$i]}"\
		-s ${dtest[1]} -o $rffile$i &;
done;
echo Waiting...
wait;
